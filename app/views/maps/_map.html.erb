<script>
  var map;
  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 35.6581, lng: 139.7017},
      zoom: 15,
      styles: [
        {stylers: [{weight: 3}]},
        {
          featureType: 'landscape',
          elementType: 'labels.icon',
          stylers: [{visibility: 'off'}]
        },
        {
          featureType: 'poi',
          elementType: 'labels.icon',
          stylers: [{visibility: 'off'}]
        },
        {
          featureType: 'transit.station.airport',
          elementType: 'labels.icon',
          stylers: [{visibility: 'off'}]
        }
      ],
    });

    var newMarker;
    map.addListener('click', function(e) {
      map.panTo({lat: e.latLng.lat(), lng: e.latLng.lng()}); 
      if(newMarker != null){
        newMarker.setMap(null);
        newMarker = null;
      }

      $.ajax({
        url: 'blogs/new',
        type: 'GET',
        data: {
          latitude: e.latLng.lat(),
          longitude: e.latLng.lng(),
        },
        success: function() {
          console.log('success');
        },
        error: function() {
          console.log('error')
        },
      });

      newMarker = new google.maps.Marker({
        position: e.latLng,
        map: map,
        title: e.latLng.toString(),
        animation: google.maps.Animation.DROP,
      });
      
      newMarker.addListener('click', function() {
        this.setMap(null);
        $.ajax({
        url: 'blogs',
        type: 'GET',
        success: function() {
          console.log('success');
        },
        error: function() {
          console.log('error')
        },
      });
      });
    });
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%=ENV["API_KEY"]%>&callback&callback=initMap" async defer></script>